<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>KK2025</title>

		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Macondo&display=swap" rel="stylesheet">

		<style>
			html,
			body {
				margin: 0;
				padding: 0;
				height: 100%;
				overflow: hidden;
				background: #000;
				color: white;
				font-family: "Macondo", cursive;
			}

			#pdf-container {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: black;
				display: none;
				justify-content: center;
				align-items: center;
			}

			canvas {
				max-width: 100%;
				max-height: 100%;
				object-fit: contain;
			}

			#timer-container {
				position: fixed;
				bottom: 5vh;
				right: 5vh;
				width: 15%;
				display: flex;
				justify-content: center;
				align-items: center;
				user-select: none;
				background: #000;
				border-radius: 12px;
				padding: 1vh;
				transition: opacity 0.3s ease;
			}

			#timer-container.hidden {
				opacity: 0;
				pointer-events: none;
			}

			#timer {
				display: flex;
				justify-content: center;
				align-items: center;
				font-size: 3vw;
			}

			.digit {
				width: 0.8em;
				text-align: center;
				margin: 0 -0.05em;
			}

			.flash-white {
				animation: flashWhite 0.3s ease;
			}

			@keyframes flashWhite {
				0% {
					color: white;
				}

				50% {
					color: black;
				}

				100% {
					color: white;
				}
			}

			@keyframes flashRed {
				0% {
					color: rgb(255, 50, 50);
				}

				50% {
					color: rgb(255, 255, 255);
				}

				100% {
					color: rgb(255, 50, 50);
				}
			}

			.flashing-red {
				animation: flashRed 1s infinite;
			}

			#file-drop {
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: #000;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				border: 3px dashed rgba(255, 255, 255, 0.3);
				transition: 0.3s;
			}

			#file-drop.dragover {
				background: rgba(255, 255, 255, 0.05);
				border-color: white;
			}

			#file-drop p {
				font-size: 2vw;
				color: white;
				margin-bottom: 2vh;
			}

			#file-input {
				display: none;
			}

			#pick-btn {
				background: white;
				color: black;
				border: none;
				padding: 1vh 2vw;
				border-radius: 10px;
				cursor: pointer;
				font-family: "Macondo", cursive;
				font-size: 1.5vw;
			}

			#pick-btn:hover {
				background: #ccc;
			}
		</style>
	</head>

	<body>
		<div id="file-drop">
			<p>Drag & Drop your PDF here or</p>
			<button id="pick-btn">Pick PDF</button>
			<input type="file" id="file-input" accept="application/pdf">
		</div>

		<div id="pdf-container">
			<canvas id="pdf-canvas"></canvas>
		</div>

		<div id="timer-container">
			<div id="timer"></div>
		</div>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

		<script>const pdfjsLib = window['pdfjs-dist/build/pdf'];
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
    const canvas = document.getElementById('pdf-canvas');
    const ctx = canvas.getContext('2d');
    const pdfContainer = document.getElementById('pdf-container');
    const fileDrop = document.getElementById('file-drop');
    const fileInput = document.getElementById('file-input');
    const pickBtn = document.getElementById('pick-btn');
    let pdfDoc = null;
    let pageNum = 1;

    async function renderPage(num) {
      const page = await pdfDoc.getPage(num);
      const unscaledViewport = page.getViewport({ scale: 1 });
      const scale = Math.min(window.innerWidth / unscaledViewport.width, window.innerHeight / unscaledViewport.height);
      const viewport = page.getViewport({ scale });
      canvas.width = viewport.width;
      canvas.height = viewport.height;
      const renderContext = { canvasContext: ctx, viewport: viewport };
      await page.render(renderContext).promise;
    }

    function loadPDF(arrayBuffer) {
      const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });
      loadingTask.promise.then(pdf => {
        pdfDoc = pdf;
        pageNum = 1;
        fileDrop.style.display = 'none';
        pdfContainer.style.display = 'flex';
        renderPage(pageNum);
      });
    }

    fileDrop.addEventListener('dragover', (e) => {
      e.preventDefault();
      fileDrop.classList.add('dragover');
    });
    fileDrop.addEventListener('dragleave', () => fileDrop.classList.remove('dragover'));
    fileDrop.addEventListener('drop', (e) => {
      e.preventDefault();
      fileDrop.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file && file.type === "application/pdf") {
        const reader = new FileReader();
        reader.onload = () => loadPDF(reader.result);
        reader.readAsArrayBuffer(file);
      }
    });
    pickBtn.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file && file.type === "application/pdf") {
        const reader = new FileReader();
        reader.onload = () => loadPDF(reader.result);
        reader.readAsArrayBuffer(file);
      }
    });
    window.addEventListener('resize', () => {
      if (pdfDoc) renderPage(pageNum);
    });

    let totalSeconds = 300;
    let interval = null;
    let running = false;
    const timerContainer = document.getElementById('timer-container');
    const timerDisplay = document.getElementById('timer');
    let flashingRed = false;

    function renderTime() {
      timerDisplay.innerHTML = '';
      const negative = totalSeconds < 0;
      const absSec = Math.abs(totalSeconds);
      const min = Math.floor(absSec / 60);
      const sec = absSec % 60;
      const str = `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
      const chars = [
        negative ? '-' : ' ', str[0], str[1], str[2], str[3], str[4], ' '
      ];
      for (const char of chars) {
        const d = document.createElement('div');
        d.classList.add('digit');
        d.textContent = char;
        timerDisplay.appendChild(d);
      }
    }

    function startTimer() {
      if (running) return;
      running = true;
      interval = setInterval(() => {
        totalSeconds--;
        renderTime();
        if ([60, 120, 180, 240].includes(totalSeconds)) flashTextWhite();
        if (totalSeconds === 0 && !flashingRed) {
          flashingRed = true;
          timerDisplay.classList.add('flashing-red');
        }
      }, 1000);
    }

    function pauseTimer() {
      clearInterval(interval);
      running = false;
    }

    function resetTimer() {
      pauseTimer();
      totalSeconds = 300;
      flashingRed = false;
      timerDisplay.classList.remove('flashing-red');
      renderTime();
    }

    function flashTextWhite() {
      timerDisplay.classList.add('flash-white');
      setTimeout(() => timerDisplay.classList.remove('flash-white'), 300);
    }

    document.addEventListener('keydown', (e) => {
      if (!pdfDoc) return;

      switch (e.key.toLowerCase()) {
        case 'arrowright':
        case 'l':
          if (pageNum < pdfDoc.numPages) {
            pageNum++;
            renderPage(pageNum);
          }
          break;
        case 'arrowleft':
        case 'j':
          if (pageNum > 1) {
            pageNum--;
            renderPage(pageNum);
          }
          break;

        case 'arrowup':
          totalSeconds++;
          renderTime();
          break;
        case 'arrowdown':
          totalSeconds--;
          renderTime();
          break;

        case ' ':
          startTimer();
          break;
        case 'p':
          pauseTimer();
          break;
        case 'r':
          resetTimer();
          break;
        case 'b':
          totalSeconds++;
          renderTime();
          break;
        case 'o':
          totalSeconds--;
          renderTime();
          break;
        case 'h':
          timerContainer.classList.toggle('hidden');
          break;
      }
    });

    renderTime();
    </script>
	</body>

</html>
